#!/bin/bash

# download logs
echo "Please enter the hostname:"
echo -n "odroid-"
read HOST_END

REMOTE_DIR="$1"
LOCAL_DIR="$2"

RECURSE=$3

if [[ $HOST_END == *"cam"* ]]
then
    # this is a multi-hop download
    echo "Detected multihop.  Please enter the gps hostname:"
    echo -n "    odroid-"
    read HOST_END_MIDDLE

    SSH_TRANSPORT="-e ssh -A odroid@odroid-$HOST_END_MIDDLE ssh odroid@odroid-$HOST_END"

else
    SSH_TRANSPORT="odroid@odroid-$HOST_END"
fi

echo "Downloading logs for from: $SSH_TRANSPORT..."

echo rsync --progress "$RECURSE" -z "$SSH_TRANSPORT":$REMOTE_DIR $LOCAL_DIR

if [[ $HOST_END == *"cam"* ]]
then
    rsync --progress --no-inc-recursive $RECURSE -z "$SSH_TRANSPORT" :$REMOTE_DIR $LOCAL_DIR
else
    rsync --progress  --no-inc-recursive $RECURSE -z "$SSH_TRANSPORT":$REMOTE_DIR $LOCAL_DIR
fi

